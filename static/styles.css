<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Text Scanner — CopyCat</title>
<style>

  #demoPresetWrap{
    display:flex;
    align-items:center;
    gap:8px;
    flex-wrap:wrap;
    font-size:0.9em;
  }

 :root{
  /* Base palette – slightly more neutral / professional dark */
  --bg:      #0f1116;
  --panel:   #171a23;
  --panel-2: #12141b;
  --border:  #252837;
  --muted:   #a4abbf;
  --text:    #f4f4f7;
  --accent:  #4f86ff;
  --good:    #38b26a;
  --warn:    #f2c94c;
  --bad:     #ef6a6a;
  --scale:   1.50;

  /* Tooltip + live drawer */
  --tip-bg:    rgba(248, 251, 255, 0.96);
  --tip-border:rgba(126, 180, 255, 0.45);
  --tip-text:  #0f1630;
  --live-h:    40vh;
}

/* Theme variants (optional) */
:root[data-theme="dark-professional"] {
  /* same as base – you can omit this if base is your default */
}

/* --- LCARS (TNG-style) theme --- */
:root[data-theme="lcars"] {
  /* Background + panels */
  --bg: #000000;          /* space black */
  --panel: #050b18;       /* deep navy panel */
  --panel-2: #050b18;
  --border: #151b2b;

  /* Text */
  --text: #fdf7e3;        /* pale LCARS cream */
  --muted: #b0a8a0;

  /* Accents */
  --accent:   #f2a94f;    /* amber/orange */
  --accent-2: #f27b7b;    /* salmon */
  --accent-3: #5bb5ff;    /* light blue */
  --accent-4: #a88cf2;    /* LCARS lilac / purple */
  --good: #7bd87a;
  --warn: #ffdd5c;
  --bad:  #ff6d6d;
}

/* LCARS look tweaks */
:root[data-theme="lcars"] body {
  font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
  letter-spacing: 0.03em;
}

/* Cards = flat panels with LCARS bar */
:root[data-theme="lcars"] .card {
  background: var(--panel);
  border-radius: 0;
  border: none;
  box-shadow: none;
  position: relative;
  overflow: visible;
}

:root[data-theme="lcars"] .card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  height: 10px;
  width: 40%;
  background: var(--accent);
  border-bottom-right-radius: 999px;
}

/* Buttons → LCARS pads */
:root[data-theme="lcars"] .btn {
  background: var(--accent);
  color: #120b05;
  border-radius: 999px;
  font-weight: 700;
  text-transform: uppercase;
  font-size: 0.85em;
  border: none;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.7);
}

:root[data-theme="lcars"] .btn.secondary {
  background: var(--accent-2);
  color: #1a0505;
}

:root[data-theme="lcars"] .btn.ghost {
  background: transparent;
  color: var(--text);
  border-radius: 999px;
  border: 1px solid var(--accent-3);
}

/* Pills (mode badge etc.) */
:root[data-theme="lcars"] .pill {
  background: var(--accent-2);
  border-radius: 999px;
  border: none;
  color: #1a0505;
  font-weight: 700;
  text-transform: uppercase;
  font-size: 0.8em;
}

/* Progress bar strip */
:root[data-theme="lcars"] .progress {
  background: #3a405a;
  border-radius: 0;
}
:root[data-theme="lcars"] .progress > span {
  background: var(--accent-3);
}

/* Tabs */
:root[data-theme="lcars"] .live-tabs {
  border-radius: 999px;
  border: none;
  background: #15192b;
}
:root[data-theme="lcars"] .live-tab {
  border-radius: 999px;
  text-transform: uppercase;
  font-size: 0.8em;
}
:root[data-theme="lcars"] .live-tab.active {
  background: var(--accent);
  color: #120b05;
}


/* unified html/body + layout shell */
html, body {
  margin:0;
  height:100%;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
  font-size:calc(16px * var(--scale));
  line-height:1.55;
}

/* main shell fills the window */
body{
  min-height:100vh;
  display:flex;
}

/* outer container */
.wrap{
  flex:1;
  width:98vw;
  max-width:var(--wrap-max);
  margin:22px auto;
  padding:16px 16px 24px;
  box-sizing:border-box;
}


#liveResizeHandle{
  height:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:ns-resize;
}
#liveResizeHandle::before{
  content:"";
  width:46px;
  height:4px;
  border-radius:999px;
  background:rgba(255,255,255,.25);
}
  
.grid{display:grid;gap:18px}
.cols{
  grid-template-columns: minmax(0,1.25fr) minmax(0,1fr);
  align-items:stretch;
}
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:18px;
  overflow:visible;
  height:100%;          /* cards fill the column height */
}

/* Scope to the advanced block only */
#advMetricsBox {
  margin-top: 18px;
}

/* Advanced metric cards: a little more breathing room */
#advMetricsBox .card {
  padding: 10px 12px;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid rgba(255, 255, 255, 0.06);
}

/* Card titles (“Stylometry”, “Nonsense guard”, etc) */
#advMetricsBox .card > .muted {
  font-size: 0.85rem;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  margin-bottom: 6px;
}

/* Tighter, more readable metric rows in Advanced only */
#advMetricsBox .kv {
  font-size: 0.85rem;
  row-gap: 2px;
}

/* Labels a bit softer than the values */
#advMetricsBox .kv > div:nth-child(odd) {
  opacity: 0.8;
}

/* Light separators between metric rows (skip very first row) */
#advMetricsBox .kv > div:nth-child(odd):not(:first-child) {
  border-top: 1px solid rgba(255, 255, 255, 0.05);
  padding-top: 4px;
  margin-top: 2px;
}


  @media (max-width:1100px){ .cols{grid-template-columns:1fr} }

    /* Live drawer layout polish */
  #liveDrawer .split {
    align-items: flex-start;
  }

  /* Give a bit of breathing room between left + right columns */
  #liveDrawer .split > div:first-child {
    padding-right: 8px;
  }
  #liveDrawer .split > div:last-child {
    padding-left: 8px;
  }

  /* Slightly tighter spacing under the metrics row */
  #liveResult {
    margin-top: 8px;
  }

  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap; overflow:visible}
  .right{text-align:right}
  label{color:var(--muted)}
  input[type="text"], input[type="number"], select, textarea{
    width: 100%;
    background: var(--panel-2);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 14px;
    min-height: 42px;
    font-size: 1em;
  }




  textarea{min-height:360px;resize:vertical}
  .btn{background:var(--accent);border:none;color:#091120;padding:11px 16px;border-radius:10px;font-weight:700;cursor:pointer;min-height:42px}

/* Make form fields fit neatly inside their containers */
input[type="text"],
input[type="number"],
select,
textarea {
  box-sizing: border-box;
}


  .btn.secondary{
    background: var(--panel-2);
    color: var(--text);
    border: 1px solid var(--border);
  }

  .btn.ghost{
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text);
  }
 
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .muted{color:var(--muted)}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}

  .pill{
    padding: 4px 10px;
    border-radius: 999px;
    background: var(--panel-2);
    color: var(--text);
    border: 1px solid var(--border);
  }

  .bar{
    height: 22px;
    border: 1px solid var(--border);
    border-radius: 12px;
    background: var(--panel-2);
    position: relative;
  }
  
  .bar>.fill{position:absolute;left:0;top:0;bottom:0;width:0;border-radius:12px}
  .fill.good{background:var(--good)} .fill.warn{background:var(--warn)} .fill.bad{background:var(--bad)}
  .kv{display:grid;grid-template-columns: 1fr auto;gap:8px 16px}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid var(--border);padding:8px 10px;text-align:left}
  th{color:var(--muted)}
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .footer{margin-top:14px;color:var(--muted);font-size:.95em}

.drawer{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  background:var(--panel-2);
  border-top:1px solid var(--border);
  transform:translateY(100%);
  transition:transform .25s ease;
  z-index:50;

  /* NEW: fixed height & flex so inner content fits */
  height:var(--live-h);
  display:flex;
  align-items:stretch;
}

.drawer.open{ transform:translateY(0); }

.drawer-inner{
  max-width:var(--wrap-max);
  width:98vw;
  margin:0 auto;
  padding:10px 18px 18px;

  /* NEW: let content scroll inside drawer instead of growing it */
  max-height:100%;
  overflow:auto;
}


    /* Live drawer layout */
  .split{
    display:grid;
    grid-template-columns: minmax(0,1.4fr) minmax(0,1fr);
    gap:18px;
    align-items:flex-start;
  }
  @media (max-width:1024px){
    .split{grid-template-columns: 1fr}
  }

  .live-left textarea{
    min-height:350px;
    max-height:510px;
  }

  .live-metrics-header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    margin-bottom:6px;
  }

  .live-tabs{
    display:inline-flex;
    align-items:center;
    border-radius:999px;
    border:1px solid var(--border);
    overflow:hidden;
    font-size:.85em;
    white-space:nowrap;
  }
  .live-tab{
    background:transparent;
    border:none;
    color:var(--muted);
    padding:4px 10px;
    cursor:pointer;
  }
  .live-tab.active{
    background:#1a2346;
    color:#eaf0ff;
  }

  .progress{
    height: 10px;
    border-radius: 6px;
    background: var(--panel-2);
    overflow: hidden;
  }

  .progress>span{
    display: block;
    height: 100%;
    width: 0;
    background: var(--accent);
    transition: width .25s;
  }

/* Optional: hide the hint on very small screens */
@media (max-width: 700px) {
  #btnLive::after {
    content: '';
  }
}


 .scale-wrap{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
  justify-content:flex-end;
}

  input[type="range"]{accent-color:#7eb4ff}

  /* ---- HELP DOT + BALLOON ---- */
  .help-wrap{display:inline-flex; align-items:center; gap:8px; overflow:visible}
  .help-dot{
    position:relative; display:inline-flex; align-items:center; justify-content:center;
    width:1.4em; height:1.4em; min-width:1.4em; min-height:1.4em;
    border:1.5px solid var(--border); border-radius:999px; color:#cfe0ff; background:#10162a;
    font-weight:800; line-height:1; user-select:none; cursor:help; overflow:visible;
  }

  #explainWrap{
  margin-top:.5rem;
  border:1px solid var(--border);
  border-radius:10px;
  overflow:hidden;
  background:var(--panel-2);
  color:var(--text);
}

#explainHeader{
  display:flex; justify-content:space-between; align-items:center;
  padding:.65rem .9rem;
  background:var(--panel);
  border-bottom:1px solid var(--border);
}

#explainToggleBtn{
  all:unset;
  cursor:pointer;
  padding:.25rem .55rem;
  border:1px solid var(--border);
  border-radius:6px;
  font-size:.9rem;
  color:var(--text);
}

  .help-dot::after{ content:"?"; font-size:.9em; transform:translateY(-1px); }

  /* balloon defaults (RIGHT side) */
  .help-dot > .tip{
    position:absolute; inset:auto auto auto 100%;
    transform:translate(10px,-50%); top:50%;
    min-width:240px; max-width:360px;
    background:var(--tip-bg); color:#eaf0ff;
    border:1px solid var(--tip-border); border-radius:12px; padding:10px 12px;
    font-size:.95em; line-height:1.4; box-shadow:0 18px 40px rgba(0,0,0,.55);
    z-index:9999; white-space:normal; word-break:normal; overflow-wrap:anywhere;
    opacity:0; visibility:hidden; pointer-events:none;
    transition:opacity .14s ease, transform .14s ease, visibility .14s;
    backface-visibility:hidden;
  }
  .help-dot::before{
    content:""; position:absolute; left:100%; top:50%; transform:translate(2px,-50%) rotate(90deg);
    border:7px solid transparent; border-top-color:var(--tip-border);
    filter:drop-shadow(0 2px 0 rgba(0,0,0,.22));
    opacity:0; visibility:hidden; transition:opacity .14s ease, transform .14s ease, visibility .14s;
    z-index:10000;
  }

  /* show states */
  .help-dot:hover > .tip,
  .help-dot:focus-visible > .tip,
  .help-dot[data-open="1"] > .tip{
    opacity:1; visibility:visible; transform:translate(10px,-50%) scale(1);
    pointer-events:auto;
  }
  .help-dot:hover::before,
  .help-dot:focus-visible::before,
  .help-dot[data-open="1"]::before{
    opacity:1; visibility:visible;
  }

  /* When a right-edge dot has class="help-dot tip-l", open bubble to the LEFT */
.tip-l.help-dot:hover > .tip,
.tip-l.help-dot:focus-visible > .tip,
.tip-l.help-dot[data-open="1"] > .tip{
  transform: translate(-10px,-50%) scale(1);  /* flip to the left */
}

/* Arrow for left-opening variant */
.tip-l.help-dot:hover::before,
.tip-l.help-dot:focus-visible::before,
.tip-l.help-dot[data-open="1"]::before{
  transform: translate(-2px,-50%) rotate(-90deg);
}


  /* top/bottom variants if you ever need them */
  .tip-t.help-dot > .tip{ inset:auto auto 100% 0; transform:translate(0,-10px); top:auto; left:0; }
  .tip-t.help-dot::before{ left:16px; top:auto; bottom:100%; transform:translateY(-2px) rotate(0deg); }
  /* ---- LEFT-SIDE TOOLTIP VARIANT ---- */
/* For help dots near the right edge: class="help-dot tip-l" */

.tip-l.help-dot > .tip{
  /* Position bubble to the LEFT of the dot */
  inset: auto 100% auto auto;   /* right:100% */
  left: auto;
  right: 100%;
  top: 50%;
  transform: translate(-10px,-50%);
}

/* Little arrow also flips to point right -> left */
.tip-l.help-dot::before{
  left: auto;
  right: 100%;
  top: 50%;
  bottom: auto;
  transform: translate(-2px,-50%) rotate(-90deg);
}

  .tip-b.help-dot > .tip{ inset:100% auto auto 0; transform:translate(0,10px); top:auto; left:0; }
  .tip-b.help-dot::before{ left:16px; top:100%; transform:translateY(2px) rotate(180deg); }

  @media (prefers-reduced-motion: reduce){
    .help-dot > .tip, .help-dot::before, .drawer, .progress>span{ transition:none !important; }
  }

  /* Accessibility */
  button,.btn,.drawer button{font-size:1.05em;padding:12px 18px;min-height:46px;border-radius:12px}
  .btn.ghost{border-width:1.5px}
  input[type="text"],input[type="number"],select{min-height:46px;font-size:1.05em;padding:12px 14px}
  table th,table td{padding:10px 12px;font-size:1.02em}
  details>summary{font-size:1.05em;padding:6px 0;cursor:pointer}
  button:focus-visible,select:focus-visible,input:focus-visible,textarea:focus-visible{outline:3px solid #7eb4ff;outline-offset:2px}

  /* --- Light tooltip override (paste at END of <style>) --- */
.help-dot > .tip{
  background: var(--tip-bg);
  color: var(--tip-text);
  border-color: var(--tip-border);
  box-shadow: 0 18px 40px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.05) inset;
  backdrop-filter: saturate(120%) blur(0.5px);
}
.help-dot::before{
  border-top-color: var(--tip-bg);
  filter: drop-shadow(0 2px 0 rgba(0,0,0,.18));
}

  /* v0.3.5 Explain UI */
  .band-badge { display:inline-flex; align-items:center; gap:.5rem; font-weight:600; font-size:.95rem; padding:.35rem .6rem; border-radius:.6rem; border:1px solid rgba(0,0,0,.2); background:#f6f6f6; }
  .band-human{ background:#e8f7ec; border-color:#7ad58f; }
  .band-mixed{ background:#fff7e0; border-color:#e2c35c; }
  .band-ai{ background:#fde8e8; border-color:#e28b8b; }
  .badge-dot{ width:.55rem; height:.55rem; border-radius:50%; display:inline-block; }
  .dot-human{ background:#26a269; } .dot-mixed{ background:#cfae2d; } .dot-ai{ background:#c23333; }
  #explainWrap{ margin-top:.5rem; border:1px solid #2d2d2d; border-radius:10px; overflow:hidden; background:#111; color:#ddd; }
  #explainHeader{ display:flex; justify-content:space-between; align-items:center; padding:.65rem .9rem; background:#181818; border-bottom:1px solid #2d2d2d; }
  #explainTitle{ font-weight:600; }
  #explainToggleBtn{ all:unset; cursor:pointer; padding:.25rem .55rem; border:1px solid #444; border-radius:6px; font-size:.9rem; color:#ddd; }
  #explainBody{ padding:.8rem .9rem; display:block; }
  #explainBody.hidden{ display:none; }
  .explain-section{ margin:.4rem 0 .6rem; }
  .explain-section b{ color:#fff; }
  .explain-list{ margin:.35rem 0 0 .9rem; }
  .explain-note{ opacity:.85; }
  


  /* Base PD badge shape */

/* PD badge – base (dark theme) styling */
#pdBadge{
  margin-left: 8px;
  padding: 0.1rem 0.6rem;
  border-radius: 999px;
  font-size: 0.8rem;
  font-weight: 600;
  border: 1px solid var(--border);
  background: #163626; /* dark PD green for dark theme */
  color: #e6ffe6;
}


/* DARK THEME LOOK (default) */
#pdBadge.pd-ok {
  background: #163626;
  color: #cafad7;
}
#pdBadge.pd-none {
  background: #2f2a12;
  color: #f4e2c0;
}

/* Stronger, more readable verdict pill */
.band-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 12px;
  border-radius: 999px;
  font-size: 0.9rem;
  font-weight: 600;
  border: 1px solid #1f5135;
}

/* HUMAN = dark green pill, light text */
.band-badge.band-human {
  background: #123524;
  color: #e8fff4;
}

/* AI = dark red pill, light text */
.band-badge.band-ai {
  background: #3b1515;
  color: #ffecec;
}

/* MIXED / inconclusive = amber */
.band-badge.band-mixed {
  background: #2f2713;
  color: #fff4d6;
}

/* dot styles */
.band-badge .badge-dot {
  width: 8px;
  height: 8px;
  border-radius: 999px;
}

.band-badge .badge-dot.dot-human  { background: #4ade80; }
.band-badge .badge-dot.dot-ai     { background: #f97373; }
.band-badge .badge-dot.dot-mixed  { background: #eab308; }


  /* Live drawer right-side spacing */
.split > div:last-child {
  padding: 8px 12px 10px;
}

/* Give the tabs and sections some breathing room */
#liveTabs {
  margin-bottom: 8px;
}

#liveResult {
  margin-top: 8px;
}

#liveDriftBox {
  margin-top: 8px;
}

/* ===== Live Verification Cat + Butterfly ===== */

/* Give the drift card its own slightly lighter scene background */
/* ===== Live Verification Cat + Butterfly ===== */

/* Give the drift card its own slightly lighter scene background */
#liveDriftBox {
  background: #141b33;
  position: relative;
  overflow: hidden;
}

#liveFunZone {
  position: relative;
  width: 100%;
  height: 220px;           /* was 140px – this fixes the “half cat” */
  margin-top: 12px;
  overflow: hidden;
  pointer-events: none;
  display: none;
  opacity: 0;
  border-radius: 12px;
  background:
    radial-gradient(circle at 20% 0%, #263566 0, #141a33 40%, #0a0d1f 100%);
  box-shadow: 0 0 18px rgba(0,0,0,0.75) inset;
  transition: opacity 0.35s ease;
}


#liveFunZone.active {
  display: block;
  opacity: 1;
}

/* Base sprite positioning */
#liveFunZone .cat,
#liveFunZone .butterfly {
  position: absolute;
}

/* ---------- CAT: sprite sheet from /static/cat-sprite.png ---------- */
/* Assumes 4x4 grid of 16 frames, each 256x256.
   If that’s different, we’ll tweak the JS frame size, not this CSS. */

/* CAT: sprite sheet + horizontal prowl */
#liveFunZone .cat {
  bottom: -8px;                                /* sit on “floor” of taller zone */
  left: 2%;
  width: 256px;
  height: 256px;
  background-image: url("/static/cat-sprite.png");
  background-repeat: no-repeat;
  image-rendering: pixelated;
  transform-origin: 50% 100%;
  z-index: 1;
}

/* Only animate when Live Fun Zone is active */
#liveFunZone.active .cat {
  animation: catProwl 10s ease-in-out infinite;
}

/* Move from left → mid-right → left while it runs its frames */
@keyframes catProwl {
  0% {
    transform: translateX(0) scale(0.80);
  }
  20% {
    transform: translateX(14vw) scale(0.80);
  }
  40% {
    transform: translateX(26vw) scale(0.80);
  }
  60% {
    transform: translateX(32vw) scale(0.80);
  }
  80% {
    transform: translateX(16vw) scale(0.80);
  }
  100% {
    transform: translateX(0) scale(0.80);
  }
}


/* “Butt wiggle / grooming / panic” body motion – sprite frames are layered on top */
@keyframes catAct {
  0%   { transform: translateX(0) translateY(0)   scale(0.7) rotate(0deg); }
  10%  { transform: translateX(-4px) translateY(3px)  scale(0.7,0.74) rotate(-3deg); }
  20%  { transform: translateX(0)   translateY(0)   scale(0.7,0.7)  rotate(2deg); }
  30%  { transform: translateX(3px) translateY(4px)  scale(0.68,0.76) rotate(-4deg); }
  40%  { transform: translateX(0)   translateY(2px)  scale(0.69,0.73) rotate(4deg); }
  55%  { transform: translateX(2px) translateY(-4px) scale(0.72)      rotate(0deg); }
  70%  { transform: translateX(6px) translateY(-2px) scale(0.71)      rotate(-2deg); }
  85%  { transform: translateX(2px) translateY(0)    scale(0.7)       rotate(1deg); }
  100% { transform: translateX(0)   translateY(0)    scale(0.7)       rotate(0deg); }
}

/* ---------- Butterflies (CSS/SVG for now; sprite file later if you want) ---------- */

#liveFunZone .butterfly {
  width: 90px;
  height: 60px;
  bottom: 60px;
  transform-origin: 50% 50%;
  z-index: 2;  /* above cat */
}

/* wings: color-cycle + glow */
#liveFunZone .butterfly-body ellipse {
  fill: #2d7ff9;  /* start blue */
  stroke: #cbe1ff;
  stroke-width: 1.3;
  filter:
    drop-shadow(0 0 4px rgba(45,127,249,0.9))
    drop-shadow(0 0 8px rgba(45,127,249,0.7));
  transform-origin: 40px 30px;
  animation: wingFlap 0.4s ease-in-out infinite,
             butterflyColor 6s linear infinite;
}

/* butterfly body + antennae */
#liveFunZone .butterfly-body rect {
  fill: #101b34;
}

#liveFunZone .butterfly-body path {
  fill: none;
  stroke: #101b34;
  stroke-width: 1.4;
}

/* Position + animation assignment for each butterfly */
#liveFunZone .butterfly.b1 { left: 18vw; animation: butterflySolo 14s linear infinite; }
#liveFunZone .butterfly.b2 { left: 20vw; animation: butterflyPair 14s linear infinite; }
#liveFunZone .butterfly.b3 { left: 23vw; animation: butterflyPair 14s linear infinite; }
#liveFunZone .butterfly.b4 { left: 26vw; animation: butterflySwarm 14s linear infinite; }

/* Butterfly color: blue → pink → orange → blue */
@keyframes butterflyColor {
  0%, 100% { fill: #2d7ff9; stroke: #cbe1ff; }
  33%      { fill: #ff6fbf; stroke: #ffd1ea; }
  66%      { fill: #ffae42; stroke: #ffe0a3; }
}

/* b1: solo, then top of triangle swarm */
@keyframes butterflySolo {
  0%   { transform: translate(2vw, 0px)  scale(1)   rotate(0deg);   opacity: 1;   }
  16%  { transform: translate(12vw,-10px) scale(1.03) rotate(-10deg);             }
  32%  { transform: translate(24vw,-6px)  scale(1.07) rotate(8deg);               }
  45%  { transform: translate(40vw,-34px) scale(0.96) rotate(18deg); opacity:.85; }
  55%  { transform: translate(56vw,-78px) scale(0.85) rotate(28deg); opacity:0;   }
  78%  { transform: translate(56vw,-26px) scale(0.9)  rotate(-10deg);opacity:0;   }
  88%  { transform: translate(30vw,-24px) scale(1)   rotate(6deg);   opacity:1;   }
  96%  { transform: translate(14vw,-22px) scale(1.02) rotate(-4deg);              }
  100% { transform: translate(8vw,-20px)  scale(1)   rotate(0deg);  opacity:1;    }
}

/* b2 / b3: chased pair, then bottom corners of triangle */
@keyframes butterflyPair {
  0%,34% { transform: translate(10vw,-10px) scale(1) rotate(0deg); opacity:0;  }
  40%    { transform: translate(16vw,-10px) scale(1.04) rotate(-8deg);opacity:1;}
  55%    { transform: translate(28vw,-16px) scale(1.07) rotate(10deg);         }
  65%    { transform: translate(44vw,-42px) scale(0.96) rotate(20deg);opacity:.85;}
  78%    { transform: translate(60vw,-76px) scale(0.86) rotate(28deg);opacity:0; }
  88%    { transform: translate(26vw,-4px)  scale(1)    rotate(4deg); opacity:1;  }
  96%    { transform: translate(10vw,-4px)  scale(1.02) rotate(-4deg);           }
  100%   { transform: translate(4vw,-4px)   scale(1)    rotate(0deg); opacity:1;  }
}

/* b4: back point of triangle only */
@keyframes butterflySwarm {
  0%,71% { transform: translate(60vw,-14px) scale(1) rotate(0deg); opacity:0; }
  80%    { transform: translate(36vw,-14px) scale(1) rotate(-4deg);opacity:1; }
  94%    { transform: translate(18vw,-14px) scale(1.02) rotate(4deg);         }
  100%   { transform: translate(8vw,-14px)  scale(1) rotate(0deg);  opacity:1; }
}

/* wings flapping */
@keyframes wingFlap {
  0%   { transform: scaleY(1);    }
  50%  { transform: scaleY(0.82); }
  100% { transform: scaleY(1);    }
}

/* === Light theme polish (CopyCat) =============================== */
/* Make both data-theme="light" and "light-paper" use the same palette */

:root[data-theme="light"],
:root[data-theme="light-paper"] {
  /* Cooler, softer light palette */
  --bg:       #f4f5fb;   /* page background behind cards */
  --panel:    #ffffff;   /* main cards */
  --panel-2:  #eef1ff;   /* secondary cards / inputs */
  --text:     #111827;   /* primary text */
  --muted:    #6b7280;   /* labels / minor text */
  --accent:   #2563eb;   /* primary blue */
  --border:   #d1d5db;   /* card border */

  /* Result + badge surfaces */
  --bar-bg:   #e5edff;   /* probability bar background */
  --pill-bg:  #e0ecff;   /* generic pill / badge background */

  /* Tooltip colors on light */
  --tip-bg:     rgba(255, 255, 255, 0.98);
  --tip-border: rgba(37, 99, 235, 0.4);
  --tip-text:   #111827;
}

/* Probability bar in "Result" */
:root[data-theme="light"] .bar,
:root[data-theme="light-paper"] .bar {
  background: var(--bar-bg);
}

/* === Donut probability gauge ==================================== */
/* Row with main donut(s) under "Calibrated probability" */
.prob-donut-row{
  display:flex;
  align-items:center;
  gap:20px;
  margin-top:8px;
  margin-bottom:4px;    /* keep content pulled up */
  flex-wrap:wrap;
}

/* Center the hero donut in the Result card */
#result .prob-donut-row {
  justify-content: center;
  margin: 10px 0 6px;
}


.prob-donut{
  position:relative;
  flex:0 0 110px;
  width:110px;
  height:110px;
}

/* rotate so 0% starts at top, grows clockwise */



/* In the main Result card, use donuts only (no horizontal bar) */
/*#result .bar{
  display:none;
}*/

/* In the Result card, keep the bar for layout, but make it invisible */
#result .bar{
  height: 0;
  margin-top: 2px;
  border: none;
  background: transparent;
  overflow: hidden;
}

/* rotate so 0% starts at top, grows clockwise */
.prob-donut svg{
  width:100%;
  height:100%;
  transform:rotate(-90deg);
}

/* background ring – uses theme-ish color */
.prob-donut .donut-bg{
  fill:none;
  stroke:rgba(255,255,255,0.12);      /* dark theme */
  stroke-width:4;
}

/* value ring – gradient from green → yellow → red */
.prob-donut .donut-val{
  fill:none;
  stroke:url(#probGradient);
  stroke-width:5;
  stroke-linecap:round;
  /* JS will set real dash values; these are safe defaults */
  stroke-dasharray:100 100;
  stroke-dashoffset:100;
  transition:stroke-dashoffset .35s ease;
}

/* center label */
.prob-donut-center{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:.9rem;
  font-weight:600;
}

/* Light theme tweak so the background ring is softer on cream */
:root[data-theme="light"],
:root[data-theme="light-paper"] {
  --prob-donut-bg: rgba(0,0,0,0.15);
}

:root[data-theme="light"] .prob-donut .donut-bg,
:root[data-theme="light-paper"] .prob-donut .donut-bg{
  stroke: var(--prob-donut-bg, rgba(0,0,0,0.15));
}


/* All generic pills / badges (top-left status, mode badge, etc.) */
:root[data-theme="light"] .pill,
:root[data-theme="light-paper"] .pill {
  background: var(--pill-bg);
  color: #2b2116;
  border-color: rgba(0,0,0,0.14);
}

/* PD: 4 badge next to the title */
:root[data-theme="light"] #pdBadge,
:root[data-theme="light-paper"] #pdBadge {
  background: var(--pill-bg);
  color: #2b2116;
  font-weight: 600;
}

/* Verdict pill keeps its dynamic background; just force readable text */
:root[data-theme="light"] #verdictPill,
:root[data-theme="light-paper"] #verdictPill {
  color: #ffffff;
}

/* Primary buttons – professional blue on cream */
:root[data-theme="light"] .btn,
:root[data-theme="light-paper"] .btn {
  background: var(--accent);
  color: #fdfbf5;
}

/* Secondary / ghost buttons – softer in light mode */
:root[data-theme="light"] .btn.secondary,
:root[data-theme="light-paper"] .btn.secondary,
:root[data-theme="light"] .btn.ghost,
:root[data-theme="light-paper"] .btn.ghost {
  background: #f0e0c4;
  color: #2b2116;
  border-color: var(--border);
}

/* Tiny top-row indicators */
:root[data-theme="light"] #version,
:root[data-theme="light-paper"] #version,
:root[data-theme="light"] #activeModeBadge,
:root[data-theme="light-paper"] #activeModeBadge {
  color: var(--text);
}

/* Consistency Check / drift panel – no more navy slab in light mode */
:root[data-theme="light"] #liveDriftBox,
:root[data-theme="light-paper"] #liveDriftBox {
  background: var(--panel-2);
  color: var(--text);
}

/* Style Match / Consistency Check toggle pills */
:root[data-theme="light"] .live-tabs,
:root[data-theme="light-paper"] .live-tabs {
  background: #f0e0c4;
  border-color: var(--border);
}

:root[data-theme="light"] .live-tab,
:root[data-theme="light-paper"] .live-tab {
  color: var(--muted);
}

:root[data-theme="light"] .live-tab.active,
:root[data-theme="light-paper"] .live-tab.active {
  background: var(--accent);
  color: #ffffff;
}

/* Tooltip bubble text on cream */
:root[data-theme="light"] .help-dot > .tip,
:root[data-theme="light-paper"] .help-dot > .tip {
  color: #2b2116;
}

/* =========================================================
   LCARS POLISH — SAFE VERSION
   (Only styling; no layout changes)
   ========================================================= */

/* Top bar → LCARS header strip look */
:root[data-theme="lcars"] .topbar {
  padding: 4px 10px 10px;
  border-radius: 999px;
  background: #050b18;
  border: 1px solid #252c42;
  box-shadow: 0 8px 20px rgba(0,0,0,0.7);
}

:root[data-theme="lcars"] .topbar strong {
  text-transform: uppercase;
  letter-spacing: 0.14em;
  font-size: 0.78em;
}

:root[data-theme="lcars"] #version {
  font-size: 0.72em;
  opacity: 0.85;
}

/* LCARS color pills in topbar (PD + mode badge) */
:root[data-theme="lcars"] #pdBadge {
  border-radius: 999px;
  border: 1px solid rgba(0,0,0,0.75);
  background: #163626;
  color: #f1ffe8;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

:root[data-theme="lcars"] #activeModeBadge {
  border-radius: 999px;
  border: none;
  background: #f27b7b;
  color: #180707;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

/* Theme select + scale slider → console pads */
:root[data-theme="lcars"] #themeSelect,
:root[data-theme="lcars"] #uiScale {
  border-radius: 999px;
  border: 1px solid #252c42;
  background: #15192b;
  color: #fdf7e3;
}

/* Main cards keep their layout, just get LCARS trims */
:root[data-theme="lcars"] .card {
  box-shadow: 0 10px 26px rgba(0,0,0,0.65);
}

/* Header strips on nested result cards */
:root[data-theme="lcars"] #result .card::before {
  height: 7px;
  width: 42%;
  background: #5bb5ff;
}

/* Live drawer → LCARS console styling without size changes */
:root[data-theme="lcars"] #liveDrawer {
  background: #050814;
  border-top: 2px solid #f2a94f;
  box-shadow: 0 -10px 24px rgba(0,0,0,0.9);
}

:root[data-theme="lcars"] #liveResizeHandle::before {
  background: #f2a94f;
  opacity: 0.85;
}

:root[data-theme="lcars"] #liveDrawer .card::before {
  height: 6px;
  width: 60%;
  background: linear-gradient(to right, #f2a94f, #5bb5ff);
}

/* Live metrics row: LCARS label vibe */
:root[data-theme="lcars"] .live-metrics-header .row > div {
  font-size: 0.8em;
  text-transform: uppercase;
  letter-spacing: 0.12em;
}

/* Help dots → console touchpoints */
:root[data-theme="lcars"] .help-dot {
  background: #050b18;
  border-color: #f2a94f;
  color: #f2a94f;
  font-weight: 900;
  letter-spacing: 0.08em;
}

/* Tooltip bubble tuned for LCARS */
:root[data-theme="lcars"] .help-dot > .tip {
  background: rgba(10,15,32,0.98);
  color: #fdf7e3;
  border-color: rgba(242,169,79,0.55);
}

/* Table headers + footer as LCARS UI text */
:root[data-theme="lcars"] table th {
  text-transform: uppercase;
  letter-spacing: 0.1em;
  font-size: 0.78em;
}

:root[data-theme="lcars"] .footer {
  font-size: 0.75em;
  text-transform: uppercase;
  letter-spacing: 0.16em;
  opacity: 0.85;
}

/* Optional: subtle scrollbar styling (no layout impact) */
:root[data-theme="lcars"] *::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}
:root[data-theme="lcars"] *::-webkit-scrollbar-track {
  background: #050814;
}
:root[data-theme="lcars"] *::-webkit-scrollbar-thumb {
  background: #f2a94f;
  border-radius: 999px;
}

/* =========================================================
   LCARS DECOR v2 – rails, chips, console slabs
   (Pure decoration – no layout changes)
   ========================================================= */

:root[data-theme="lcars"] .wrap {
  position: relative;
  z-index: 1;
  /* keep main UI inside the rails */
  padding-left: 110px;
  padding-right: 110px;
}

/* --------- LEFT / RIGHT RAILS (SNAKING BARS) ---------- */

:root[data-theme="lcars"] .wrap::before,
:root[data-theme="lcars"] .wrap::after {
  content: "";
  position: fixed;
  top: 18px;
  bottom: 24px;
  width: 90px;
  pointer-events: none;
  z-index: 0;
}

/* LEFT rail: stacked colors + notch like your ref */
:root[data-theme="lcars"] .wrap::before {
  left: 0;
  border-radius: 0 40px 40px 0;
  background:
    /* notch cut-out */
    linear-gradient(to bottom,
      transparent 0,
      transparent 17%,
      #000 17%,
      #000 25%,
      transparent 25%,
      transparent 100%
    ),
    /* LCARS color stack */
    linear-gradient(to bottom,
      #f2a94f 0,
      #f2a94f 30%,
      #f27b7b 30%,
      #f27b7b 63%,
      #a88cf2 63%,
      #a88cf2 100%
    );
  box-shadow:
    0 0 0 2px #000 inset,
    0 0 22px rgba(0,0,0,0.9);
}

/* RIGHT rail: mirrored stack */
:root[data-theme="lcars"] .wrap::after {
  right: 0;
  border-radius: 40px 0 0 40px;
  background:
    linear-gradient(to bottom,
      transparent 0,
      transparent 12%,
      #000 12%,
      #000 20%,
      transparent 20%,
      transparent 100%
    ),
    linear-gradient(to bottom,
      #a88cf2 0,
      #a88cf2 28%,
      #f2a94f 28%,
      #f2a94f 60%,
      #f27b7b 60%,
      #f27b7b 100%
    );
  box-shadow:
    0 0 0 2px #000 inset,
    0 0 22px rgba(0,0,0,0.9);
}

/* --------- TOP CONSOLE SLAB (behind header) ---------- */

:root[data-theme="lcars"] body::before {
  content: "";
  position: fixed;
  left: 110px;
  right: 110px;
  top: 22px;
  height: 64px;
  border-radius: 36px 36px 18px 18px;
  background:
    linear-gradient(to right,
      #f2a94f 0,
      #f2a94f 26%,
      #f27b7b 26%,
      #f27b7b 55%,
      #a88cf2 55%,
      #a88cf2 100%
    );
  box-shadow:
    0 0 0 2px #000 inset,
    0 14px 30px rgba(0,0,0,0.85);
  pointer-events: none;
  z-index: 0;
}

/* --------- BOTTOM STATUS BAND ---------- */

:root[data-theme="lcars"] body::after {
  content: "";
  position: fixed;
  left: 90px;
  right: 90px;
  bottom: 12px;
  height: 24px;
  border-radius: 18px 18px 8px 8px;
  background: linear-gradient(to right,
    #f2a94f 0,
    #f2a94f 50%,
    #f27b7b 50%,
    #f27b7b 75%,
    #5bb5ff 75%,
    #5bb5ff 100%
  );
  box-shadow:
    0 0 0 2px #000 inset,
    0 -8px 18px rgba(0,0,0,0.8);
  pointer-events: none;
  z-index: 0;
}

/* --------- SIDE “CHIP” STACK (like vertical buttons) ---------- */

:root[data-theme="lcars"] .lcars-chips,
:root[data-theme="lcars"] .lcars-chips::before,
:root[data-theme="lcars"] .lcars-chips::after {
  pointer-events: none;
}

/* We fake the chip column with a fixed, invisible element */
:root[data-theme="lcars"] .wrap::marker { /* noop to keep CSS valid in some editors */ }

/* actual chips – attach to .wrap via another pseudo */
:root[data-theme="lcars"] .wrap > *:first-child::before {
  content: "";
  position: fixed;
  left: 78px;
  top: 45%;
  width: 18px;
  height: 180px;
  transform: translateY(-50%);
  background:
    linear-gradient(to bottom,
      #f27b7b 0,
      #f27b7b 18%,
      transparent 18%,
      transparent 26%,
      #a88cf2 26%,
      #a88cf2 44%,
      transparent 44%,
      transparent 52%,
      #f2a94f 52%,
      #f2a94f 70%,
      transparent 70%,
      transparent 78%,
      #5bb5ff 78%,
      #5bb5ff 100%
    );
  border-radius: 999px;
  box-shadow:
    0 0 0 2px #000 inset,
    0 0 10px rgba(0,0,0,0.8);
  z-index: 0;
}

/* --------- TOPBAR STATUS LINE TWEAK ---------- */

:root[data-theme="lcars"] .topbar {
  position: relative;
}

/* Subtle LCARS space-dock backdrop */
:root[data-theme="lcars"] body {
  background:
    radial-gradient(circle at 15% 0%,  #1a2340 0, transparent 45%),
    radial-gradient(circle at 85% 100%, #2b3256 0, transparent 45%),
    linear-gradient(to bottom, #02030a 0, #02030a 40%, #050814 100%);
}

/* Little “status bar” line under the topbar (no layout change) */
:root[data-theme="lcars"] .topbar::after {
  content: "";
  position: absolute;
  left: 90px;
  right: 90px;
  bottom: -6px;
  height: 3px;
  border-radius: 999px;
  background: linear-gradient(to right, #f27b7b, #f2a94f, #5bb5ff);
  opacity: 0.85;
  pointer-events: none;
}

/* --- RESULT CARD: hide old horizontal bar completely --- */
#result .bar,
#result .bar > .fill {
  display: none !important;
}

/* === HERO DONUT – bigger, clean, actually circular === */
#result .prob-donut {
  flex: 0 0 220px;
  width: 220px;
  height: 220px;
}

#result .prob-donut svg {
  shape-rendering: geometricPrecision; /* smoother circle edges */
}

#result .prob-donut-center {
  font-size: 1.1rem;
  font-weight: 700;
}

/* Same thickness for track + arc, but thin enough to fit in 40x40 viewBox */
#result .prob-donut .donut-bg,
#result .prob-donut .donut-val {
  stroke-width: 8px;
}

/* Round ends now that we’re not clipping against the box */
#result .prob-donut .donut-val {
  stroke-linecap: butt;
}

/* small-screen safety */
@media (max-width: 900px) {
  #result .prob-donut {
    flex: 0 0 180px;
    width: 180px;
    height: 180px;
  }
}

/* Result donut: solid LCARS color instead of gradient */
#result .prob-donut .donut-val {
  stroke: var(--accent, var(--accent));
}

/* Frame the donut between explanation (left) and metrics (right) */
#resultSummaryRow {
  display: grid;
  grid-template-columns: minmax(0, 1.3fr) auto minmax(0, 1.3fr);
  align-items: center;
  gap: 32px;
  margin-top: 12px;
  margin-bottom: 26px;
}

/* center column: donut stays centered, same size */
#resultSummaryRow .result-summary-center {
  display: flex;
  justify-content: center;
  align-items: center;
}

/* make sure donut row centers inside this layout */
#resultSummaryRow .prob-donut-row {
  justify-content: center;
}

/* left text hugs donut */
#resultSummaryRow .result-summary-left {
  font-size: 0.95em;
  line-height: 1.4;
}
#resultSummaryRow .result-summary-left .muted {
  max-width: 34rem;
  text-align: right;
}

/* right column uses your existing kv grid but a bit tighter */
.kv-compact {
  row-gap: 4px;
  font-size: 0.9em;
}

/* responsive: stack on small screens, donut first */
@media (max-width: 1100px) {
  #resultSummaryRow {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  #resultSummaryRow .result-summary-left .muted {
    text-align: left;
  }
  #resultSummaryRow .result-summary-center {
    order: -1; /* donut on top on narrow screens */
  }
}

/* === LCARS right-panel tabs (under Runtime Settings) ================ */

.lcars-panel {
  margin-top: 18px;
  padding-top: 10px;
  border-top: 1px solid var(--border);
  /* keep it inside the card, full width of the card content */
}

.lcars-tabs {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 10px;
}

.lcars-tab {
  border: none;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  cursor: pointer;

  background: var(--panel-2);
  color: var(--text);
  border: 1px solid var(--border);
}

.lcars-tab-active {
  background: var(--accent);
  color: #120b05;
}

.lcars-tab-content {
  /* just normal flow inside the card */
}

.tab-section {
  display: none;
  font-size: 0.9rem;
  line-height: 1.5;
}

.tab-section-active {
  display: block;
}

/* ===== LCARS panel: tab layout + animated transitions ===== */

.lcars-panel {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid var(--border);
  font-size: 0.9em;
}

/* Tab strip */
.lcars-tabs {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 4px;
}

.lcars-tab {
  border: none;
  padding: 4px 10px;
  border-radius: 999px;
  background: #15192b;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-size: 0.7rem;
  cursor: pointer;
}

.lcars-tab-active {
  background: var(--accent);
  color: #120b05;
}

/* Content area with animated sections */
.lcars-tab-content {
  position: relative;
  margin-top: 10px;
  min-height: 54px;        /* keeps the panel from collapsing on quick switches */
}

/* Base state: hidden, slightly shifted down */
.tab-section {
  position: absolute;
  inset: 0 auto auto 0;
  opacity: 0;
  transform: translateY(4px);
  pointer-events: none;
  transition:
    opacity 0.18s ease-out,
    transform 0.18s ease-out;
}

/* Active section: visible + in place */
.tab-section-active {
  position: relative;
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

/* === LCARS INTERACTION EFFECTS (buttons + tabs) === */
:root[data-theme="lcars"] .btn,
:root[data-theme="lcars"] .lcars-tab,
:root[data-theme="lcars"] .live-tab {
  position: relative;
  transition:
    transform 0.12s ease-out,
    box-shadow 0.12s ease-out,
    background-color 0.15s ease-out,
    filter 0.15s ease-out;
}

/* HOVER: lift + brighten */
:root[data-theme="lcars"] .btn:not(:disabled):hover,
:root[data-theme="lcars"] .lcars-tab:not(:disabled):hover,
:root[data-theme="lcars"] .live-tab:not(:disabled):hover {
  transform: translateY(-2px);
  box-shadow:
    0 0 0 1px rgba(0,0,0,0.9),
    0 8px 18px rgba(0,0,0,0.65);
  filter: brightness(1.08);
}

/* ACTIVE: pressed down */
:root[data-theme="lcars"] .btn:not(:disabled):active,
:root[data-theme="lcars"] .lcars-tab:not(:disabled):active,
:root[data-theme="lcars"] .live-tab:not(:disabled):active {
  transform: translateY(2px) scale(0.97);
  box-shadow:
    0 0 0 1px rgba(0,0,0,0.9),
    0 3px 8px rgba(0,0,0,0.8);
  filter: brightness(0.96);
}

/* FOCUS RING */
:root[data-theme="lcars"] .btn:focus-visible,
:root[data-theme="lcars"] .lcars-tab:focus-visible,
:root[data-theme="lcars"] .live-tab:focus-visible {
  outline: 2px solid #5bb5ff;
  outline-offset: 2px;
}

/* DISABLED: dead flat */
:root[data-theme="lcars"] .btn:disabled,
:root[data-theme="lcars"] .lcars-tab:disabled,
:root[data-theme="lcars"] .live-tab:disabled {
  opacity: 0.55;
  cursor: not-allowed;
  box-shadow: none;
  transform: none;
  filter: none;
}

/* === LCARS SUPER-GLOW INTERACTIONS === */
:root[data-theme="lcars"] .btn,
:root[data-theme="lcars"] .lcars-tab,
:root[data-theme="lcars"] .live-tab {
  position: relative;
  transition:
    transform 0.12s ease-out,
    box-shadow 0.15s ease-out,
    filter 0.15s ease-out,
    background-color 0.15s ease-out;
}

/* HOVER: strong LCARS glow + raised plate */
:root[data-theme="lcars"] .btn:not(:disabled):hover,
:root[data-theme="lcars"] .lcars-tab:not(:disabled):hover,
:root[data-theme="lcars"] .live-tab:not(:disabled):hover {
  transform: translateY(-3px);
  box-shadow:
    0 0 6px rgba(255, 204, 112, 0.9),    /* LCARS amber outer glow */
    0 0 20px rgba(255, 155, 50, 0.75),   /* second glow layer */
    0 10px 20px rgba(0, 0, 0, 0.65);     /* shadow behind */
  filter: brightness(1.20) saturate(1.2);
}

/* ACTIVE: pressed with inner glow */
:root[data-theme="lcars"] .btn:not(:disabled):active,
:root[data-theme="lcars"] .lcars-tab:not(:disabled):active,
:root[data-theme="lcars"] .live-tab:not(:disabled):active {
  transform: translateY(2px) scale(0.96);
  box-shadow:
    0 0 4px rgba(255, 204, 112, 0.8),
    0 0 10px rgba(255, 155, 50, 0.6),
    inset 0 0 12px rgba(255, 175, 75, 0.75); /* LCARS inner glow */
  filter: brightness(0.95);
}

/* Focused (keyboard nav): distinct blue LCARS ring */
:root[data-theme="lcars"] .btn:focus-visible,
:root[data-theme="lcars"] .lcars-tab:focus-visible,
:root[data-theme="lcars"] .live-tab:focus-visible {
  outline: 2px solid #5bb5ff;
  outline-offset: 3px;
}

/* Extra vertical spacing between upper-right panel and Runtime Settings */
/*@media (min-width: 900px) {
  section[aria-label="Runtime Settings"] {
    margin-top: 40px;  /* ~“about an inch” visually, tweak as needed */
  }
}*/

/* =========================================================
   LCARS side panel – layout, spacing, micro-animations
   ========================================================= */

.lcars-panel {
  margin-top: 12px;
  padding-top: 10px;
  border-top: 1px solid var(--border);
  font-size: 0.92em;
}

.lcars-tabs {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
  margin-bottom: 8px;
}

.lcars-tab {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 11px;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: rgba(7, 10, 22, 0.9);
  color: var(--muted);
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 0.09em;
  font-size: 0.7rem;
  white-space: nowrap;
  transition:
    background 0.18s ease,
    color 0.18s ease,
    box-shadow 0.18s ease,
    transform 0.08s ease,
    opacity 0.18s ease;
}

.lcars-tab-icon {
  font-size: 0.85em;
  opacity: 0.8;
}

.lcars-tab-label {
  position: relative;
  top: 0.5px;
}

.lcars-tab-active {
  background: var(--accent);
  color: #120b05;
  box-shadow:
    0 0 0 1px rgba(0, 0, 0, 0.7),
    0 0 18px rgba(242, 169, 79, 0.55);
}

.lcars-tab:hover {
  transform: translateY(-1px);
  box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.65);
  opacity: 0.98;
}

.lcars-tab:focus-visible {
  outline: 2px solid var(--accent-3, #5bb5ff);
  outline-offset: 2px;
}

.lcars-tab-content {
  border-radius: 10px;
  background: var(--panel-2);
  padding: 10px 12px;
  box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.65) inset;
}

/* Sections fade in instead of snapping */
.tab-section {
  display: none;
  animation: lcarsTabFade 0.18s ease-out;
}

.tab-section-active {
  display: block;
}

.lcars-section-title {
  text-transform: uppercase;
  letter-spacing: 0.12em;
  font-size: 0.68rem;
  color: var(--muted);
  margin: 0 0 6px;
}

.lcars-kv {
  display: grid;
  grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
  gap: 4px 10px;
}

.lcars-kv > div:first-child {
  opacity: 0.85;
}

.lcars-kv .mono {
  text-align: right;
}

.lcars-subtext {
  margin-top: 6px;
  font-size: 0.85em;
  opacity: 0.85;
}

.lcars-pill-inline {
  display: inline-flex;
  align-items: center;
  padding: 2px 7px;
  border-radius: 999px;
  border: 1px solid rgba(0,0,0,0.55);
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.lcars-pill-inline.good {
  background: #163626;
  color: #cafad7;
}

.lcars-pill-inline.warn {
  background: #2f2a12;
  color: #f4e2c0;
}

.lcars-pill-inline.bad {
  background: #3a1b1b;
  color: #ffd4d4;
}

.lcars-empty {
  font-style: italic;
  opacity: 0.8;
}

.lcars-history-list {
  margin: 4px 0 0;
  padding-left: 1.1rem;
  max-height: 160px;
  overflow-y: auto;
}

.lcars-history-list li {
  margin-bottom: 2px;
  font-size: 0.85em;
}

/* Tiny scrollbars inside LCARS panel only */
.lcars-history-list::-webkit-scrollbar {
  width: 6px;
}
.lcars-history-list::-webkit-scrollbar-thumb {
  border-radius: 999px;
  background: var(--accent-4, #a88cf2);
}

@keyframes lcarsTabFade {
  from {
    opacity: 0;
    transform: translateY(2px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Verdict pill text: always white for readability */
#verdictPill {
  color: #ffffff !important;
  font-weight: 700;
}


/* Advanced metrics toggle bar */

.adv-metrics {
  margin-top: 16px;
}

.adv-summary {
  list-style: none;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 10px 14px;
  background: rgba(242, 169, 79, 0.14);
  border-radius: 999px;
  border: 1px solid rgba(242, 169, 79, 0.75);
  cursor: pointer;
  user-select: none;
  box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.4);
}

.adv-summary::-webkit-details-marker {
  display: none;
}

.adv-summary-left {
  display: flex;
  flex-direction: column;
}

.adv-summary-label {
  font-weight: 600;
  font-size: 0.98rem;
}

.adv-summary-sub {
  font-size: 0.8rem;
  opacity: 0.85;
}

/* Chevron */
.adv-summary-chevron {
  font-size: 1.15rem;
  transform: rotate(0deg);
  transition: transform 0.15s ease-out;
}

/* Closed state: stronger glow so it pulls the eye */
.adv-metrics:not([open]) .adv-summary {
  background: rgba(242, 169, 79, 0.08);
  box-shadow:
    0 0 0 1px rgba(242, 169, 79, 0.9),
    0 0 18px rgba(242, 169, 79, 0.45);
}

/* Open state: chevron flipped up */
.adv-metrics[open] .adv-summary-chevron {
  transform: rotate(180deg);
}

.adv-body {
  margin-top: 12px;
}

/* Make summary behave like a centered button container */
.adv-btn-summary {
  list-style: none;
  display: flex;
  justify-content: center;
  margin: 20px 0;
  cursor: pointer;
}

.adv-btn-summary::-webkit-details-marker {
  display: none;
}

/* CopyCat button style (same as Scan / Open Live Verification) */
.copycat-btn {
  background: #f2a94f;
  color: #000;
  padding: 10px 22px;
  border-radius: 50px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition:
    transform 0.15s ease,
    box-shadow 0.15s ease,
    background 0.15s ease;
}

/* Hover raise */
.copycat-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(242, 169, 79, 0.4);
}

/* Active press */
.copycat-btn:active {
  transform: translateY(1px);
  box-shadow: 0 2px 6px rgba(242, 169, 79, 0.2);
}

/* Slide-out "What this means" panel */
.explain-panel {
  position: fixed;
  inset-block: 0;
  right: 0;
  width: 100%;
  max-width: 420px;
  background: var(--bg, #050816);
  box-shadow: -0.5rem 0 1.5rem rgba(0, 0, 0, 0.7);
  transform: translateX(100%);
  opacity: 0;
  transition: transform 220ms ease-out, opacity 220ms ease-out;
  z-index: 500;
  display: flex;
}

.explain-panel.open {
  transform: translateX(0);
  opacity: 1;
}

.explain-panel-inner {
  padding: 16px;
  width: 100%;
  overflow-y: auto;
}

/* Dimmed click-to-close background */
.explain-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(2px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 180ms ease-out;
  z-index: 490;
}

.explain-backdrop.show {
  opacity: 1;
  pointer-events: auto;
}

/* Keep explain sections readable inside the panel */
#explainBody .explain-section {
  margin-bottom: 10px;
}

/* Keep content column narrower and easier on the eyes */
.explain-panel-inner {
  max-width: 640px;
  margin: 0 auto;
  font-size: 0.95rem;
  line-height: 1.5;
}

/* Section spacing */
#explainBody .explain-section {
  margin-bottom: 14px;
}

/* Section titles inside the panel */
#explainBody .explain-section b {
  display: block;
  margin-bottom: 4px;
  font-weight: 600;
}

/* Lists: give them a bit of air */
#explainBody .explain-list {
  padding-left: 1.2em;
  margin: 4px 0 0;
}

#explainBody .explain-list li {
  margin-bottom: 4px;
}

/* Notes: make them slightly softer so they read as extra context */
#explainBody .explain-note {
  font-size: 0.9rem;
  opacity: 0.9;
}

/* Raw JSON inside Advanced: compact and scrollable */
#rawJsonBox {
  margin-top: 10px;
}

#rawJsonBox > summary {
  font-size: 0.85rem;
  cursor: pointer;
}

#rawDump {
  max-height: 220px;
  overflow: auto;
  margin-top: 6px;
  padding: 8px 10px;
  border-radius: 8px;
  background: rgba(0, 0, 0, 0.45);
  border: 1px solid rgba(255, 255, 255, 0.06);
  font-size: 11px;
  line-height: 1.35;
}

/* Raw JSON: readable + respects global scale */
#rawDump {
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size: 0.90em;      /* scales with --scale because html/body use em */
  line-height: 1.45;
}

/* ===== CopyCat LIGHT THEME – button readability fix ===== */

/* Primary action buttons (Scan, Save, Live Verification, etc.) */
:root[data-ui-theme="light"] .btn,
html[data-ui-theme="light"] .btn,
:root[data-theme="light"] .btn,
html[data-theme="light"] .btn {
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  color: #f9fafb;
  border: none;
  border-radius: 999px;
  font-weight: 600;
  box-shadow: 0 8px 20px rgba(37, 99, 235, 0.30);
}

/* Secondary buttons – softer pill, dark text, clear border */
:root[data-ui-theme="light"] .btn.secondary,
html[data-ui-theme="light"] .btn.secondary,
:root[data-theme="light"] .btn.secondary,
html[data-theme="light"] .btn.secondary {
  background: #e5e7f5;
  color: #111827;
  border: 1px solid #cbd2f0;
  box-shadow: 0 2px 6px rgba(15, 23, 42, 0.08);
}

/* Ghost / subtle buttons – transparent with clear outline */
:root[data-ui-theme="light"] .btn.ghost,
html[data-ui-theme="light"] .btn.ghost,
:root[data-theme="light"] .btn.ghost,
html[data-theme="light"] .btn.ghost {
  background: transparent;
  color: #1f2937;
  border: 1px solid #cbd5f5;
  box-shadow: none;
}

/* Disabled state: dimmed but still readable */
:root[data-ui-theme="light"] .btn:disabled,
html[data-ui-theme="light"] .btn:disabled,
:root[data-theme="light"] .btn:disabled,
html[data-theme="light"] .btn:disabled {
  opacity: 0.55;
  cursor: not-allowed;
  box-shadow: none;
}

/* ===== LIGHT THEME: make pills / tabs readable ===== */

:root[data-ui-theme="light"] .chip,
html[data-ui-theme="light"] .chip,
:root[data-theme="light"] .chip,
html[data-theme="light"] .chip,
:root[data-ui-theme="light"] .tab-pill,
html[data-ui-theme="light"] .tab-pill,
:root[data-theme="light"] .tab-pill,
html[data-theme="light"] .tab-pill,
:root[data-ui-theme="light"] .pill,
html[data-ui-theme="light"] .pill,
:root[data-theme="light"] .pill,
html[data-theme="light"] .pill {
  color: #f9fafb !important;    /* bright white text */
  font-weight: 600;             /* thicker, matches buttons */
  letter-spacing: 0.02em;       /* tiny bit more presence */
}

/* ===== LIGHT THEME: make PD tabs readable ===== */
:root[data-ui-theme="light"] .card button:not(#btnScan):not(#btnSaveConfig):not(.live-tab),
html[data-ui-theme="light"] .card button:not(#btnScan):not(#btnSaveConfig):not(.live-tab),
:root[data-theme="light"] .card button:not(#btnScan):not(#btnSaveConfig):not(.live-tab),
html[data-theme="light"] .card button:not(#btnScan):not(#btnSaveConfig):not(.live-tab) {
  background: #111827 !important;            /* dark navy chip */
  color: #f9fafb !important;                 /* bright white text */
  border-radius: 999px !important;           /* pill shape */
  font-weight: 600 !important;               /* thicker text */
  padding: 4px 12px !important;
  font-size: 0.78rem !important;             /* a bit bigger/readable */
  border: 1px solid #0f172a !important;
}

/* ===== LIGHT THEME: make LCARS tabs readable ===== */
:root[data-theme="light"] .lcars-tab,
:root[data-theme="light-paper"] .lcars-tab,
html[data-theme="light"] .lcars-tab,
html[data-theme="light-paper"] .lcars-tab,
:root[data-ui-theme="light"] .lcars-tab,
html[data-ui-theme="light"] .lcars-tab {
  background: #020617 !important;      /* dark slate pill */
  color: #e5e7eb !important;           /* light gray text */
  border-color: #0f172a !important;
  font-weight: 600 !important;         /* thicker */
  padding: 4px 12px !important;
  border-radius: 999px !important;
}

/* Active state: bright blue pill, white text */
:root[data-theme="light"] .lcars-tab.lcars-tab-active,
:root[data-theme="light-paper"] .lcars-tab.lcars-tab-active,
html[data-theme="light"] .lcars-tab.lcars-tab-active,
html[data-theme="light-paper"] .lcars-tab.lcars-tab-active,
:root[data-ui-theme="light"] .lcars-tab.lcars-tab-active,
html[data-ui-theme="light"] .lcars-tab.lcars-tab-active {
  background: #2563eb !important;      /* same gradient family as main buttons */
  color: #f9fafb !important;           /* white text */
  box-shadow:
    0 0 0 1px rgba(15, 23, 42, 0.9),
    0 6px 16px rgba(37, 99, 235, 0.35) !important;
}

/* ==== Live Verification drawer: clearer sections + textarea ==== */

/* Give the two columns inside the live drawer a card frame */
#liveDrawer .split > div {
  background: var(--panel);
  border-radius: 12px;
  border: 1px solid var(--border);
  padding: 10px 12px;
}

/* Make the live textarea stand out a bit more in all themes */
#liveDrawer .live-left textarea {
  background: var(--panel-2);
  border: 1px solid var(--border);
  padding: 12px 14px;      /* ← universal inner space */
  box-sizing: border-box;  /* ← keeps width calculations sane */
}

/* Light themes: bright, obvious input area */
html[data-theme="light"] #liveDrawer .live-left textarea,
html[data-theme="light-paper"] #liveDrawer .live-left textarea {
  background: #e6efff;          /* light blue panel */
  border-color: #c3d3ff;
}

/* Dark “pro” theme: drawer is dark, textarea slightly lifted */
html:not([data-theme="light"])
    :not([data-theme="light-paper"])
    :not([data-theme="lcars"]) #liveDrawer .live-left textarea {
  background: #050816;          /* darker well */
  border-color: #1e293b;        /* subtle outline */
}

/* Keep LCARS exactly as-is */
html[data-theme="lcars"] #liveDrawer .split > div,
html[data-theme="lcars"] #liveDrawer .live-left textarea {
  background: inherit;
  border: none;
  padding: 0;
}

/* LCARS: give the live-typing panel a proper console background */
:root[data-theme="lcars"] #liveDrawer .live-left {
  background: #050b18;            /* same family as the drift panel */
  border-radius: 14px;
  padding: 12px 14px 16px;        /* a little breathing room around the textarea */
  box-shadow: 0 0 0 1px #151b2b inset;
}

/* LCARS: make the textarea itself clearly “inside” that console */
:root[data-theme="lcars"] #liveDrawer .live-left textarea {
  background: #02030f;
  border-color: #151b2b;
  color: #fdf7e3;
}

/* LCARS: Live Verification input panel */
:root[data-theme="lcars"] #liveDrawer .split > div:first-child,
html[data-theme="lcars"] #liveDrawer .split > div:first-child {
  background: #050b18;              /* same family as right-side metrics panel */
  border-radius: 14px;
  border: 1px solid #151b2b;
  padding: 12px 14px 14px;
}

/* LCARS: textarea slab inside that panel */
:root[data-theme="lcars"] #liveDrawer #liveInput,
html[data-theme="lcars"] #liveDrawer #liveInput {
  background: #070d1e;
  border: 1px solid #252c42;
  box-sizing: border-box;
  width: 100%;
}
/* === LCARS live drawer: make input black, surround with LCARS blue card === */

:root[data-theme="lcars"] #liveDrawer .live-left {
  background: #050b18;              /* same kind of blue as the right panel */
  border-radius: 16px;
  padding: 10px 12px 14px;
  box-shadow:
    0 0 0 2px #000 inset,
    0 10px 24px rgba(0, 0, 0, 0.9);
}

/* Textarea itself: black slab, high contrast text */
:root[data-theme="lcars"] #liveInput {
  background: #000000;
  color: #fdf7e3;
  border-radius: 10px;
  border: 1px solid #12192e;
}

/* Make sure it fills the card cleanly */
:root[data-theme="lcars"] #liveInput {
  width: 100%;
  box-sizing: border-box;
}

/* Placeholder text readable on black */
:root[data-theme="lcars"] #liveInput::placeholder {
  color: rgba(253, 247, 227, 0.55);
}

/* === LCARS live drawer: clear, card-style input area ==================== */

/* Left column “card” behind the textarea */
:root[data-theme="lcars"] #liveDrawer .live-left {
  background: var(--panel) !important;   /* same dark blue as right panel */
  border-radius: 14px !important;
  padding: 10px 12px 14px !important;
  box-shadow:
    0 0 0 2px #000 inset,
    0 10px 22px rgba(0, 0, 0, 0.85) !important;
}

/* Text box itself: true black slab, high-contrast text */
:root[data-theme="lcars"] #liveDrawer #liveInput {
  background: #000000 !important;
  color: #fdf7e3 !important;
  border-radius: 10px !important;
  border: 1px solid #12192e !important;
  width: 100% !important;
  box-sizing: border-box !important;
  padding: 12px 14px !important;   /* ← NEW: inner space top/bottom + left/right */
}

/* Placeholder text on black */
:root[data-theme="lcars"] #liveDrawer #liveInput::placeholder {
  color: rgba(253, 247, 227, 0.55) !important;
}

/* === LCARS live drawer: lighter panel + black textarea ================ */

/* Surrounding panel behind the live input (left side of drawer) */
:root[data-theme="lcars"] #liveDrawer .live-left {
  background: linear-gradient(
    135deg,
    #222e5a,
    #283567
  ) !important;                 /* softer, lighter navy */
  border-radius: 14px !important;
  padding: 12px 14px 16px !important;
  box-shadow:
    0 0 0 1px rgba(0,0,0,0.9) inset,
    0 10px 24px rgba(0,0,0,0.65) !important;
}

/* Textarea itself: true black slab with bright text */
:root[data-theme="lcars"] #liveDrawer #liveInput {
  background: #000000 !important;
  color: #fdf7e3 !important;
  border-radius: 10px !important;
  border: 1px solid #5bb5ff !important;   /* brighter edge so it pops */
  width: 100% !important;
  box-sizing: border-box !important;
}

/* Placeholder on black textarea */
:root[data-theme="lcars"] #liveDrawer #liveInput::placeholder {
  color: rgba(253, 247, 227, 0.6) !important;
}

/* LCARS: drift panel matches live-input panel + light blue outline */
:root[data-theme="lcars"] #liveDriftBox {
  background: linear-gradient(135deg, #222e5a, #283567) !important;
  border-radius: 14px !important;

  /* thin light-blue accent outline + soft drop shadow */
  box-shadow:
    0 0 0 1px #7ea6ff,                     /* light blue outline */
    0 10px 24px rgba(0, 0, 0, 0.65);       /* depth shadow */
}

/* LCARS: drift panel padding + outline + background */
:root[data-theme="lcars"] #liveDriftBox {
  /* existing look */
  background: linear-gradient(135deg, #222e5a, #283567) !important;
  border-radius: 14px !important;
  box-shadow:
    0 0 0 1px #7ea6ff,                     /* light blue outline */
    0 10px 24px rgba(0, 0, 0, 0.65);

  /* NEW: breathing room so text isn’t hugging the edge */
  padding: 14px 22px 18px;
  box-sizing: border-box;
}

/* LCARS – Live verification LEFT panel wrapper around the textarea */
:root[data-theme="lcars"] #liveDrawer .live-left {
  background: linear-gradient(135deg, #222e5a, #283567);
  border-radius: 14px;
  padding: 14px 22px 18px;   /* same breathing room as drift box */
  box-sizing: border-box;

  /* same thin blue outline + soft glow */
  box-shadow:
    0 0 0 1px #7ea6ff,
    0 10px 24px rgba(0, 0, 0, 0.65);
}

/* LCARS – actual textarea inside that panel */
:root[data-theme="lcars"] #liveText {
  background: #020308;          /* solid black text field */
  color: #fdfdfd;
  border-radius: 10px;
  border: 1px solid #89b4ff;    /* inner accent line */

  padding: 10px 12px;           /* text not hugging edge */
  box-sizing: border-box;
  resize: vertical;

  /* matching glow around the textbox itself */
  box-shadow:
    0 0 0 1px #7ea6ff,
    0 0 18px rgba(126, 166, 255, 0.45);
}

/* LCARS – live verification left pane wrapper */
[data-theme="lcars"] #liveDrawer .live-left,
[data-theme="lcars"] #liveDrawer #liveLeft {
  box-sizing: border-box;
  background: #273363;              /* same blue as the drift block */
  border-radius: 10px;
  padding: 16px 20px 18px;          /* same padding feel as drift stats */
  box-shadow: 0 0 0 1px #7db7ff;    /* thin light blue outline */
}

/* Keep the textarea inset nicely inside that wrapper */
[data-theme="lcars"] #liveDrawer .live-left textarea,
[data-theme="lcars"] #liveDrawer #liveLeft textarea {
  width: 100%;
  box-sizing: border-box;
  border-radius: 6px;
  border: 1px solid #7db7ff;        /* inner blue line (what you already like) */
  padding: 10px 14px;               /* same idea as right-side padding */
}

/* === LCARS: Live Verification drawer – final tidy version === */
/* Left drift panel (bottom-right metrics block) */
:root[data-theme="lcars"] #liveDriftBox {
  background: #273363;
  border-radius: 14px;
  padding: 14px 22px 18px;
  box-sizing: border-box;
  box-shadow:
    0 0 0 1px #7db7ff,              /* thin light blue outline */
    0 10px 24px rgba(0,0,0,0.65);   /* depth shadow */
}

/* LEFT column wrapper around the textarea */
:root[data-theme="lcars"] #liveDrawer .live-left {
  background: #273363;
  border-radius: 14px;
  padding: 14px 22px 18px;          /* same breathing room as drift box */
  box-sizing: border-box;
  box-shadow:
    0 0 0 1px #7db7ff,              /* matching light blue outline */
    0 10px 24px rgba(0,0,0,0.65);
}

</style>